<!DOCTYPE html>
<html>
<head>
    <title>Webcam 2 ajax post</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
</head>
<body>
    <div>

    </div>
<video id="screenshot-stream" autoplay height="80"></video>
<!--<img id="screenshot" src="">-->
<canvas id="screenshot-canvas" style="display:block;" ></canvas>
<p>
    <button id="screenshot-button">Capture</button>
</p>
<canvas id="test-canvas" style="display:block;" ></canvas>
<script>
	var imgArrayRed = [];
	var imgArrayGreen = [];
	var imgArrayBlue = [];
    $(function() {
    	var video;
        var button = $('#screenshot-button');
        var canvas = document.getElementById('screenshot-canvas');
        var testCanvas = document.getElementById('test-canvas');
        var ctx = canvas.getContext('2d');
        var testctx = testCanvas.getContext('2d');
        canvas.width = 82;
        canvas.height = 82;
        testCanvas.width = 82;
        testCanvas.height = 82;
        var localMediaStream = null;
        navigator.webkitGetUserMedia({video: true, audio:false}, function(stream) {
        		video = document.querySelector('video');
    			video.src = window.URL.createObjectURL(stream);
            }, function () {
            	// body...
            });

    	button.click(function (e) {
    		e.preventDefault();
    		var offset = (video.videoWidth - video.videoHeight)/2;
    		ctx.drawImage(video, -21, 0,120,82);
    		translateImageToArray();
    	})

    	function translateImageToArray(){
    		imgArrayRed = [];
    		imgArrayGreen = [];
    		imgArrayBlue = [];
    		for (var i = 0; i < 40; i++) {
    			imgArrayRed[i] = [];
    			imgArrayGreen[i] = [];
    			imgArrayBlue[i] = [];
    			var deg = i*(360/40) // circle is divided by 40 = 360/40;
    			for (var led = 1; led < 41; led++) {
    				var x = led * Math.cos(deg * Math.PI / 180);
    				var y = led * Math.sin(deg * Math.PI / 180);
    				x = Math.round(x);
    				y = Math.round(y);
    				data = ctx.getImageData(x+41,41-y,1,1).data;
    				testctx.beginPath();
      				testctx.arc(x+41, 41-y, 1, 0, 2 * Math.PI, false);
      				testctx.fillStyle = rgbToHex(data);
      				testctx.fill();
      				testctx.lineWidth = 0;
      				imgArrayRed[i].push(data[0]);
      				imgArrayGreen[i].push(data[1]);
      				imgArrayBlue[i].push(data[2]);
    			};
    		};

    		for (var i = 0; i < imgArrayRed.length; i++) {
    			console.log(imgArrayRed[i].toString());
    		};
    		for (var i = 0; i < imgArrayGreen.length; i++) {
    			console.log(imgArrayGreen[i].toString());
    		};
    		for (var i = 0; i < imgArrayBlue.length; i++) {
    			console.log(imgArrayBlue[i].toString());
    		};
    	};

    	function rgbToHex(rgb){
		  return '#' + ((Math.floor(rgb[0]/24)*24 << 16) | (Math.floor(rgb[1]/24)*24 << 8) | Math.floor(rgb[2]/24)*24).toString(16);
		};

    });

</script>
</body>
</html>